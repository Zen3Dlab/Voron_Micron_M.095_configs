[gcode_macro FORM_TIP_SHAPE]
gcode:
      SAVE_GCODE_STATE NAME=FORMTIPSTATE
      
      {% set TEMP_ORIG = printer.extruder.target | default(0) %}
      {% set TEMP_TIP = printer.extruder.target - 40 | default(0) %}

      M104 S{TEMP_TIP}

      CLEAN_NOZZLE

      TEMPERATURE_WAIT SENSOR=extruder MINIMUM={TEMP_TIP-1} MAXIMUM={TEMP_TIP+1}

      G91
      G0 E2 F360
      G1 E-3 F1500    ; gyors rész
      G1 E-2 F120    ; lassú, formázó rész
      G1 E0.2 F600
      G1 E-0.6 F1200
      
      G1 E-50 F2400
      G90

      M104 S{TEMP_ORIG}
      
      CLEAN_NOZZLE
      RESTORE_GCODE_STATE NAME=FORMTIPSTATE